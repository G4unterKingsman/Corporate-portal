<h1 align="center">Corporate Portal</h1>
<h3 align="center">Содержание:</h3>
1. Описание приложения и функционала<br/>
2. Как запустить приложение?<br/>
3. Описание взаимодействия с приложением<br/>
4. Диаграмма базы данных<br/>
5. Использованные технологии и их версии<br/>

____
### I. Описание приложения и функционала
Приложение создано для компании, в которой существует необходимость обмена задачами между сотрудниками, и отчётами по этим задачам.
Сотрудники создают задачи другим сотрудникам, те их принимают, и в зависимости от выполнения или невыполнения, статус задачи меняется на "Завершен" или "Отменён" соответственно. Завершить задачу может автор задачи или адресат задачи. Также создатель задачи указывает время на выполнение в часах, от неё рассчитывается дата дедлайна, и если задача не выполнена в срок, статус меняется на "Отменён"
По итогу задачи сотрудники (автор и адресат) могут написать отчёт по задаче, вне зависимости выполнена она или нет

В приложении есть авторизация, и для этого используется сущность User, которая привязана к Сотруднику.
В контексте приложения сотрудник и пользователь - это одно и то же.

Сотрудники имеют разные роли, роли влияют на полномочия сотрудников.<br/>
ADMIN - Администратор Портала, имеет практически неограниченные полномочия (даже слишком)<br/>
-Только администратор может создавать новых сотрудников, т.е регистрация через страницу /registr не доступна.<br/>
-может просматривать и удалять все существующие в БД отчёты, задачи, профили сотрудников.<br/>
-может редактировать задачи других сотрудников.<br/>
-не может редактировать отчёты других сотрудников<br/>

USER - сотрудник компании, имеющий доступ к основным возможностям приложения.<br/>
-может создавать задачи другим сотрудникам, просматривать их, редактировать и удалять.<br/>
-может создавать отчёты по задачам, просматривать их, редактировать и удалять.<br/>
-может смотреть адресованные сотруднику задачи, взаимодействовать с ними, писать отчёты по этим задачам.<br/>
-не может взаимодействовать с задачами и отчётами, которые ему не принадлежат или не адресованы ему.<br/>

Связи сущностей:<br/>
Employee - Task **OneToMany**<br/>
Employee - Report **OneToMany**<br/>
Task - Report **OneToMany**<br/>
User - Employee **OneToOne**<br/>

Приложение написано так, что расширять, дополнять, и как-либо улучшать его не составит особого труда, я старался соблюсти чистоту кода и SOLID, чтобы это было возможным.

В файле data.sql предоставлены все нужные для тестирования данные, в таблице users пароли представлены в зашифрованном виде, у всех 1234<br/>

Профиль юзера<br/>
username: godrik<br/> 
пароль 1234<br/>

Профиль админа<br/>
username: mashasha<br/> 
пароль 1234<br/>

Профили развёртывания:<br/>
dev - Запуск без поднятия бд (im memory H2)<br/>
prod - Требуется PostgresSQL<br/>

###  II. Как запустить приложение?
1.  Клонируем проект в среду разработки
2.  Убедитесь что Java 17-й версии
3.  Запускается приложение стандартно средствами IDE, чтобы не поднимать БД можно указать профиль развёртывания dev, в таком случае будет использован H2 (in memory)

Данные для поднятия бд:<br/>
datasource:<br/>
   url: jdbc:postgresql://localhost:5432/corporate-portal<br/>
   username: postgres<br/>
   password: egaroot<br/>

   ========================================================================

### III. Описание взаимодействия с приложением

1. **Работа с сотрудниками**
    * Используемый репозиторий: JPA [EmployeeRepo.java]
    * Используемые сервисы: EmployeeServiceImpl [EmployeeServiceImpl.java]
    * Используемые Роли/Полномочия: ADMIN, USER (пользователь должен быть авторизован)

   Доступные эндпоинты:

   1.1 Найти и получить всех доступных в БД сотрудников:
    * URL: http://localhost:8080/all_employees
    * Метод: GET
    * Доступ: Авторизированным пользователям
    * Метод сервиса: getAll()

   1.2 Найти и получить профиль сотрудника по идентификатору
    * URL: http://localhost:8080/all_employees/{id}
    * Метод: GET
    * Параметры: Long id (идентификатор сотрудника)
    * Доступно только для: ADMIN или хозяину профиля
    * Метод сервиса: getById(Long id)

   1.3 Создание сотрудника в БД
    * URL: http://localhost:8080/all_employees/add_employee
    * Метод: POST
    * Доступно только для: ADMIN
    * Метод сервиса: create(EmployeeDto employeeDto)

   1.4 Обновление профиля сотрудника по идентификатору
    * URL: http://localhost:8080/all_employees/{id}/edit_employee
    * Метод: POST
    * Параметры: Long id (идентификатор сотрудника)
    * Доступно только для: ADMIN или хозяину профиля(хозяин профиля может обновить не все данные)
    * Метод сервиса: update(EmployeeDto employeeDto, Long id)

   1.5 Удаление сотрудника по идентификатору из БД
    * URL: http://localhost:8080/all_employees/{id}/delete
    * Метод: DELETE
    * Параметры: Long id (идентификатор сотрудника)
    * Доступно только для: ADMIN
    * Метод сервиса: delete(Long id)

2. **Работа с отчётами**
    * Используемый репозиторий: JPA [ReportRepo.java]
    * Используемые сервисы: ReportServiceImpl [ReportServiceImpl.java]
    * Используемые Роли/Полномочия: ADMIN, USER (пользователь должен быть авторизован)

   Доступные эндпоинты:
   2.1 Найти и получить все доступные в БД отчёты:
    * URL: http://localhost:8080/all_reports
    * Метод: GET
    * Доступ: Авторизированным пользователям
    * Метод сервиса: findAll()

   2.2 Найти и получить отчёт по идентификатору
    * URL: http://localhost:8080/all_reports/{id}
    * Метод: GET
    * Параметры: Long id (идентификатор отчёта)
    * Доступно только для: ADMIN или создателю отчёта
    * Метод сервиса: getById(Long id)

   2.3 Создание отчёта в БД
    * URL: http://localhost:8080/all_reports/add_report
    * Метод: POST
    * Доступно: Авторизированным пользователям
    * Метод сервиса: create(ReportDto reportDto)

   2.4 Обновление отчёта по идентификатору
    * URL: http://localhost:8080/all_reports/{id}/edit_report
    * Метод: POST
    * Параметры: Long id (идентификатор отчёта)
    * Доступно: Создателю отчёта
    * Метод сервиса: update(ReportDto reportDto, Long id)

   2.5 Удаление отчёта по идентификатору из БД
    * URL: http://localhost:8080/all_reports/{id}/delete
    * Метод: DELETE
    * Параметры: Long id (идентификатор отчёта)
    * Доступно только для: ADMIN или создателю отчёта
    * Метод сервиса: delete(Long id)

3. **Работа с задачами**
    * Используемый репозиторий: JPA [TaskRepo.java]
    * Используемые сервисы: TaskServiceImpl [TaskServiceImpl.java]
    * Используемые Роли/Полномочия: ADMIN, USER (пользователь должен быть авторизован)

   Доступные эндпоинты:
   3.1 Найти и получить все доступные в БД задачи:
    * URL: http://localhost:8080/all_tasks
    * Метод: GET
    * Доступ: Авторизированным пользователям
    * Метод сервиса: findAll()

   3.2 Найти и получить задачу по идентификатору
    * URL: http://localhost:8080/all_tasks/{id}
    * Метод: GET
    * Параметры: Long id (идентификатор задачи)
    * Доступно только для: ADMIN, автору задачи и адресату задачи
    * Метод сервиса: getById(Long id)

   3.3 Создание задачи в БД
    * URL: http://localhost:8080/all_tasks/add_task
    * Метод: POST
    * Доступно: Авторизированным пользователям
    * Метод сервиса: create(TaskDto taskDto)

   3.4 Обновление задачи по идентификатору
    * URL: http://localhost:8080/all_tasks/{id}/edit_task
    * Метод: POST
    * Параметры: Long id (идентификатор задачи)
    * Доступно: ADMIN и создателю задачи
    * Метод сервиса: update(TaskDto taskDto, Long id)

   3.5 Удаление задачи по идентификатору из БД
    * URL: http://localhost:8080/all_tasks/{id}/delete
    * Метод: DELETE
    * Параметры: Long id (идентификатор задачи)
    * Доступно только для: ADMIN или создателю задачи.
    * Метод сервиса: delete(Long id)
   
      ==============================================================================

### IV. Диаграмма базы данных
[![public.png](https://i.postimg.cc/Vs749x2V/public.png)](https://postimg.cc/5jCwbR4B)

### V. Использованные технологии и их версии

* Framework Spring - 6 v.
* Spring boot - 3.2.9 v.
* Spring Security - 6 v.
* Java - 17 v.
* Postgresql - 42.7.3 v.
* Mapstruct - 1.6.0 v.
* Thymeleaf - 3.1.2.RELEASE v.
* Lombok - 1.18.34 v.

Минусы приложения:
* У создания новых сотрудников через администратора есть очевидный минус - если не останется администраторов, то использование приложения становится невозможной.<br/>
  К тому же, какой-нибудь озлобленный администратор может удалить других администраторов.<br/>
* Администраторы не могут редактировать отчёты, не принадлежащие им, т.к в сервисе ReportServiceImpl в методе update есть проверка, является ли создатель отчёта автором или адресатом задачи, по которой создаётся отчёт
* Возраст сотрудника нужно указывать явно, и каждый год менять его (если конечно др не в високосный год)
  Решается это добавлением даты рождения, от которой будет считаться возраст динамически при каждом получении или обновлении данных сотрудника. (Как например считается дедлайн в Задаче)

P. S
Идеи для дальнейшего расширения и улучшения приложения:
* Добавление новой сущности Team, которая будет привязана к сотрудникам OneToMany.
  Сотрудники могут создавать задачи только сотрудникам из своей команды. У каждой команды будет руководитель.
* Добавление роли Руководителя, который может просматривать задачи/отчёты всех сотрудников в команде, а также создавать команду.
  У руководителя может быть несколько команд.
* Добавление регистрации сотрудника, путём запроса на регистрацию администратору, администратор подтвердит создание сотрудника и выдаст логин и пароль которые сотрудник может менять.
